# NTT(Number Theoretic Transform)
$R_q = Z_q[x]/(x^n+1),n是2的指数幂,q是素数，且2n|(q-1),w是Z_q中阶为2n的根,即w^{2n} = 1, \gamma = w^2~mod~q$
$给定f,g\in R_q,计算 h= fg \in R_q$
*步骤如下：*
*Step1:* 计算$\tilde{f},\tilde{g}$
$\tilde{f} = (1,w,w^2,\cdots,w^{n-1})\circ f,\tilde{g} = (1,w,w^2,\cdots,w^{n-1})\circ g$
*Step2:* 计算$\tilde{h}=NTT^{-1}(NTT(\tilde{f})\circ NTT(\tilde{g}))$
    *Step2.1:* 计算正向NTT
$\hat{f}=NTT(\tilde{f}) = \Sigma_{i=0}^{n-1}\tilde{f_i}\gamma^{ij}~mod~q,i=0,1,\cdots,n-1$
    *Step2.2:* 计算点乘 $\circ$
    *Step2.3:* 计算反向NTT
    $\tilde{f}=NTT^{-1}(\hat{f})$
    $\tilde{f_i} = n^{-1}\Sigma_{j=0}^{n-1}\hat{f_j}\gamma^{-ij}~mod~q,i=0,1,\cdots,n-1$
*Step3:* 计算$h = (1,w^{-1},w^{-2},\cdots,w^{-(n-1)})\circ \tilde{h}$
$\widehat{NTT}(f)=NTT((1,w,w^2,\cdots,w^{n-1})\circ f)$
$\widehat{NTT}^{-1}(\hat{f})=(1,w^{-1},w^{-2},\cdots,w^{-(n-1)})\circ NTT^{-1}(\hat{f})$
$h=\widehat{NTT}^{-1}(\widehat{NTT}(f)\circ \widehat{NTT}(g))$
*使用中国剩余定理CRT来计算NTT:*
![alt text](image.png)
*例子：*
$Z_{17}[x]/(x^4+1)$，计算$ntt(g),g=1+4x+2x^2+13x^3$
$n = 4, q = 17, w = 2$
$\begin{bmatrix} 1 & 2 & 4 & 8 \\ 1 & 8 & 64 & 512 \\ 1 & 32 & 1024 & 32768 \\ 1 & 128 & 16384 & 2097152\end{bmatrix}$$\begin{bmatrix} 1  \\ 4  \\ 2 \\ 13\end{bmatrix}$=$\begin{bmatrix} 2  \\ 0  \\ 16 \\ 3\end{bmatrix}$

# Pt-NTT
$R_q = Z_q[x]/(x^n+1),n是2的指数幂,q是素数，\alpha是非负整数,且\frac{n}{2^{\alpha-1}}|(q-1),w是Z_q中阶为2n的根,即w^{2n} = 1, \gamma = w^2~mod~q$
*Step1:*$对f,g做\alpha分解$
$f = \Sigma_{i=0}^{2^{\alpha}-1}x^i\tilde{f_i}(x^{2^\alpha})$,$g = \Sigma_{j=0}^{2^{\alpha}-1}x^j\tilde{g_j}(x^{2^\alpha})$
*Step2:*$计算\tilde{h_i}(z),i=0,1,\cdots,2^\alpha-1,记z = x^{2^\alpha}$
$$\tilde{h_i}(z)=\Sigma_{l=0}^i\tilde{f_l}(z)\tilde{g}_{i-l}(z)+\Sigma_{l=i+1}^{2^\alpha-1}z\tilde{f_l}(z)\tilde{g}_{2^\alpha+i-l}(z)\\=\widehat{NTT}^{-1}(\Sigma_{l=0}^i\widehat{NTT}(\tilde{f_l}(z))\circ\widehat{NTT}(\tilde{g}_{i-l}(z))+\Sigma_{l=i+1}^{2^\alpha-1}\widehat{NTT}(z)\widehat{NTT}(\tilde{f_l}(z))\circ\widehat{NTT}(\tilde{g}_{2^\alpha+i-l}(z)))$$
*可以使用Karatsuba技巧化简*
*Step3:*$计算h(x)=\Sigma_{i=0}^{2^\alpha-1}x^i\tilde{h_i}(x^{2^\alpha})$
- Pt-NTT和T-NTT
Pt-NTT是从上做$\alpha$分解，T-NTT是从下做$\beta$分解,他们在计算上是等效的

#TODO
1. T-NTT的详细计算过程
2. T-NTT与Pt-NTT的关系证明

# H-NTT(Hybrid Number Theoretic Transform)
$H(n,\alpha,\beta),R_q = Z_q[x]/(x^n+1),n是2的指数幂,q是素数，且\frac{n}{2^{\alpha+\beta-1}}|(q-1),w是Z_q中阶为2n的根,即w^{2n} = 1, \gamma = w^2~mod~q$
*Step1:*$对f,g做\alpha分解$
$f = \Sigma_{i=0}^{2^{\alpha}-1}x^i\tilde{f_i}(x^{2^\alpha})$,$g = \Sigma_{j=0}^{2^{\alpha}-1}x^j\tilde{g_j}(x^{2^\alpha})$
*Step2:*$计算\tilde{h_i}(z),i=0,1,\cdots,2^\alpha-1,记z = x^{2^\alpha}$
$$\tilde{h_i}(z)=\Sigma_{l=0}^i\tilde{f_l}(z)\tilde{g}_{i-l}(z)+\Sigma_{l=i+1}^{2^\alpha-1}z\tilde{f_l}(z)\tilde{g}_{2^\alpha+i-l}(z)\\=T-NTT^{-1}(\Sigma_{l=0}^iT-NTT(\tilde{f_l}(z))\circ T-NTT(\tilde{g}_{i-l}(z))+\Sigma_{l=i+1}^{2^\alpha-1}T-NTT(z)T-NTT(\tilde{f_l}(z))\circ T-NTT(\tilde{g}_{2^\alpha+i-l}(z)))$$
*可以使用Karatsuba技巧化简*
*Step3:*$计算h(x)=\Sigma_{i=0}^{2^\alpha-1}x^i\tilde{h_i}(x^{2^\alpha})$